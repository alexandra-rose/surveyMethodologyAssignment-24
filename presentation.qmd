---
title: "Group presentation"
date: 2024-01-24
author: "Frederick, Sofia, Alex"
format: 
  revealjs:
    theme: simple
    transition: slide
    transition-speed: fast
    embed-resources: TRUE
    slide-number: c/t
editor: visual
logo: https://www.rstudio.com/wp-content/uploads/2018/10/RStudio-Logo-Flat.png
---

## Data cleaning

-   Cleaning data

-   Tidy data

-   Joining datasets

```{r Data cleaning}
#| echo: false
library(haven)
library(readr)
library(haven) 
library(writexl)
library(sjlabelled)
library(tidyverse)
library(corrplot)
library(dplyr)
library(gmodels)
library(scales)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(ggplot2)
library(leaflet)
library(tidyverse)
library(MASS)
library(caret)
library(plotly)
library(car)
library(caret)
library(rpart)
library(rpart.plot)
library(lme4)
library(pROC)
library(caret)
library(pdp)
library(Matrix)
library(lattice)


data <- read_dta("Data/ZA7575.dta")

data_cleaning_1 <- data %>%
  select(
         -c(studyno1, studyno2, doi, version, edition,survey))

data_cleaning_2 <- data_cleaning_1 %>% 
  select(serialid, everything())

# creating a variable for country name to be more organized
data_cleaning_2$country_name <- NA
data_cleaning_2$country_name[data_cleaning_2$q1_1 == 1] <- 'Belgium'
data_cleaning_2$country_name[data_cleaning_2$q1_2 == 1] <- 'Denmark'
data_cleaning_2$country_name[data_cleaning_2$q1_3 == 1] <- 'Germany'
data_cleaning_2$country_name[data_cleaning_2$q1_4 == 1] <- 'Greece'
data_cleaning_2$country_name[data_cleaning_2$q1_5 == 1] <- 'Spain'
data_cleaning_2$country_name[data_cleaning_2$q1_6 == 1] <- 'France'
data_cleaning_2$country_name[data_cleaning_2$q1_7 == 1] <- 'Ireland'
data_cleaning_2$country_name[data_cleaning_2$q1_8 == 1] <- 'Italy'
data_cleaning_2$country_name[data_cleaning_2$q1_9 == 1] <- 'Luxembourg'
data_cleaning_2$country_name[data_cleaning_2$q1_10 == 1] <- 'Netherlands'
data_cleaning_2$country_name[data_cleaning_2$q1_11 == 1] <- 'Portugal'
data_cleaning_2$country_name[data_cleaning_2$q1_12 == 1] <- 'United Kingdom'
data_cleaning_2$country_name[data_cleaning_2$q1_13 == 1] <- 'Austria'
data_cleaning_2$country_name[data_cleaning_2$q1_14 == 1] <- 'Sweden'
data_cleaning_2$country_name[data_cleaning_2$q1_15 == 1] <- 'Finland'
data_cleaning_2$country_name[data_cleaning_2$q1_16 == 1] <- 'Cyprus'
data_cleaning_2$country_name[data_cleaning_2$q1_17 == 1] <- 'Czech Republic'
data_cleaning_2$country_name[data_cleaning_2$q1_18 == 1] <- 'Estonia'
data_cleaning_2$country_name[data_cleaning_2$q1_19 == 1] <- 'Hungary'
data_cleaning_2$country_name[data_cleaning_2$q1_20 == 1] <- 'Latvia'
data_cleaning_2$country_name[data_cleaning_2$q1_21 == 1] <- 'Lithuania'
data_cleaning_2$country_name[data_cleaning_2$q1_22 == 1] <- 'Malta'
data_cleaning_2$country_name[data_cleaning_2$q1_23 == 1] <- 'Poland'
data_cleaning_2$country_name[data_cleaning_2$q1_24 == 1] <- 'Slovakia'
data_cleaning_2$country_name[data_cleaning_2$q1_25 == 1] <- 'Slovenia'
data_cleaning_2$country_name[data_cleaning_2$q1_26 == 1] <- 'Bulgaria'
data_cleaning_2$country_name[data_cleaning_2$q1_27 == 1] <- 'Romania'
data_cleaning_2$country_name[data_cleaning_2$q1_28 == 1] <- 'Croatia'
data_cleaning_2$country_name[data_cleaning_2$q1_29 == 1] <- 'Other countries'
data_cleaning_2$country_name[data_cleaning_2$q1_30 == 1] <- 'DK'

# factor
data_cleaning_2$country_name <- factor(data_cleaning_2$country_name)

Data_Extra_by_Country <- read_delim("data_extra_by_Country.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

all_na_columns <- sapply(Data_Extra_by_Country, function(x) all(is.na(x)))

# There are columns with all NA due to the filtering in stata done before for the year 2019.

columns_to_remove <- names(Data_Extra_by_Country)[all_na_columns]

# remove the columns
Data_Extra_by_Country <- Data_Extra_by_Country[, !all_na_columns]
Data_Extra_by_Country <- Data_Extra_by_Country[, !names(Data_Extra_by_Country) %in% "e_polity2"]

# dataframe of all the variables for 2019 related to legal or political views of most of the countries in the world

Data_Extra_by_Country$country_name <- factor(Data_Extra_by_Country$country_name)

Data_Extra_by_Country <- Data_Extra_by_Country %>% 
  select(country_name,adp_general)

merged_df_1 <- merge(data_cleaning_2, Data_Extra_by_Country, by = "country_name", all.x = TRUE)

Eco_Extra_Data <- read_delim("Eco Extra Data.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE) 

merged_df <- merge(merged_df_1, Eco_Extra_Data, by = "country_name", all.x = TRUE)
```

```{r Clean Data to show}
#| echo: true

head(merged_df)

```

## Choosing the variables to build our models

-   based off of literature found

    -   Campbell, M., Hinton, J. D. X. & Anderson, J. R. (2019) A systematic review of the relationship between religion and attitudes toward transgender and gender-variant people. International Journal of Transgenderism, 20:1, 21-38, DOI: 10.1080/15532739.2018.1545149
    -   Earle, M. et al. (2021). A multilevel analysis of LGBT (Lesbian, Gay, Bisexual, Transgender) rights support across 77 countries: The role of contact and country laws . British Journal of Social Psychology. doi:10.1111/bjso.12436

## 

-   based off of literature found

    -   Flores, A. R. (2015) Attitudes toward transgender rights: perceived knowledge and secondary interpersonal contact, Politics, Groups, and Identities, 3:3, 398-416, DOI: 10.1080/21565503.2015.1050414-

    -   Flores, A. R., Brown, T. N. T., & Park, A. S. (2016). Public Support for Transgender Rights: A Twenty-three Country Survey. The Williams Institute at UCLA School of Law. <http://www.jstor.org/stable/resrep34965->

    -   Harrison, B.F., Michelson, M.R. (2019) Gender, Masculinity Threat, and Support for Transgender Rights: An Experimental Study. Sex Roles 80, 63–75. <https://doi.org/10.1007/s11199-018-0916-6>

## 

-   based off of literature found

    -   Norton, A.T., Herek, G.M. (2013) Heterosexuals’ Attitudes Toward Transgender People: Findings from a National Probability Sample of U.S. Adults. Sex Roles 68, 738–753.-
    -   Williamson, Myles, 2023, "Replication Data for: A Global Analysis of Transgender Rights: Introducing the Trans Rights Indicator Project (TRIP)", <https://doi.org/10.7910/DVN/FXXLTS,> Harvard Dataverse, V1, UNF:6:E4O2rb6DFd44VSZjm9SQNQ== \[fileUNF\]

```{=html}
<!-- -->
```
-   we added country level variables; legal rights of trans individuals variable and benchmark economic variables

## 

-   we conduct associative tests to confirm literature and narrow down the variables to X

```{r}
#| echo: false

df_descriptive <-
  df_descriptive |> 
  mutate(sd3_cat = case_when(sd3 == 1 ~ "Catholic",
                             sd3 == 2 ~ "Orthodox Christian",
                             sd3 == 3 ~ "Protestant",
                             sd3 == 4 ~ "Other Christian",
                             sd3 == 5 ~ "Jewish",
                             sd3 < 9 ~ "Muslim", 
                             sd3 < 12 ~ "Other",
                             sd3 < 14 ~ "Atheist | Agnostic",
                             sd3 == 14 ~ "Other",
                             sd3 > 14 ~ "Don't know | Refusal")) 


```

```{r Example of descriptives done}
#| echo: true
CrossTable(df_descriptive$sd3_cat, df_descriptive$qc19_multinominal,
           digits=2, 
           expected=F, 
           asresid=T, 
           chisq=TRUE, 
           prop.chisq=F, 
           format="SPSS")
```

## 

```{r}
df_descriptive |> 
  mutate(sd3_cat = fct_relevel(sd3_cat, "Don't know | Refusal", after = Inf)) |> 
  ggplot(aes(x = sd3_cat)) +
  geom_bar(fill = "black", color = "black", alpha = 0.5) +
  labs(title = "Frequency by religious affiliation",
       x = "",
       y = "Absolutec count",
       caption = "Source: Eurobarometer 91.4") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

## 

```{r}
df_descriptive |> 
  group_by(country_name) |> 
  summarise(share = mean(sd3_cat == "Orthodox Christian", na.rm = TRUE)*100) |> 
  arrange(desc(share)) |> 
  mutate(country_name = factor(country_name, levels = country_name)) |>
  filter(country_name != "Otros países") |> 
ggplot(aes(x = country_name, y = share)) +
  geom_col(fill = "red") +
  labs(title = "Share of Orthodox Christians", 
       x = "",
       y = "",
       caption = "Source: Eurobarometer 91.4") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
        plot.margin = margin(0, 0, 0, 0))  +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) +
  geom_text((aes(label = sprintf("%.1f%%", share))),vjust = -0.5, size = 2)
```
